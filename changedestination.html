<!DOCTYPE HTML>
<head>
	<title>Coordinator - Change Destination</title>
	<link href ="Helper/bootstrap.css" rel="stylesheet" type = "text/css">
	<link href ="Helper/organize.css" rel="stylesheet" type = "text/css">
	<link href="Helper/Images/icon.png" rel="icon">
	<script src="Helper/cookiesk.js" type="text/javascript">
	</script>
	<meta name = "viewport" content="initial-scale=1.0">
	<script src="Helper/jquery-2.2.4.min.js" type="text/javascript"></script>
	<script src="Helper/XHRequest.js"></script>
	<script src="Helper/bootstrap.js" type="text/javascript"></script>
	<script>
		function setDestination() {
			//generate url
			var destination = document.getElementById("destination").value;
			if (valid(destination)) {
				set(destination);
				var URL = "www.iotspace.tech/coordinator/event.html"
			}
		}
			function set(destination){
				XHRequest.createRequest({
					success: test_valid, 
					method: "GET",
					params: {
						command: "change_destination",
						destination: destination
					},
					url: "/coordinator/scripts/datbase.py"
				});
			}

			function test_valid(xhr, xhrconfig) {
				my_data = JSON.parse(xhr.responseText);
				console.log(my_data);
				var valid = my_data.complete;
				var name = my_data.name;
				if (valid == "True") {
					set_map(name);
					document.getElementById("new").innerHTML = "<hr class='next'><h3 class='text-center'>Your new destination is " + name + ".<br><a href='event.html'>Click here to go back to the main page</a></h3>";
				}
			}

			function valid(destination) {
				if (destination.length < 2 || !valid_location(destination)) {
					document.getElementById("new").innerHTML="<h1 class='text-center'>Destination is not valid.</h1>"
					return false;
				}
				else {
					return true;
				}
			}

			function valid_location(destination) {
				return true;
			}

			var url;
			function set_map(destination) {
				destination = destination.replace(/\s/g, "+");
				 url = "https://maps.googleapis.com/maps/api/staticmap?center="+destination+"&zoom=9&size=999x300&markers=|"+destination+"&key=AIzaSyD9Cyy79DLP-pvlVVYB1rBCkZwNfojOhG0";
				 console.log(url);
				document.getElementById("map").innerHTML = "<img class='static-location' src="+url+">";
			}

	</script>
</head>

<body class="static-nav">
	<nav class="navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
		      		<span class="sr-only">Toggle navigation</span>
		      		<span class="icon-bar"></span>
		      		<span class="icon-bar"></span>
		      		<span class="icon-bar"></span>
	        	</button>
    			<a href="index.html" class="navbar-brand">
    				<img src="Helper/Images/co-grey.png" class="logo" onmouseover="this.src='Helper/Images/co-white.png'" onmouseout="this.src='Helper/Images/co-grey.png'">
    			</a>
			</div>
    		<div id="navbar" class="navbar-collapse collapse">
    			<ul class="nav navbar-nav theme">
      				<li class=""><a href="index.html">Home</a></li>
      				<li><a href="newevent.html">Create a New Event</a></li>
      				<li><a href="changeuser.html">Change Username</a></li>
      				<li class="active"><a href="changedestination.html">Change Destination</a></li>
      				<li><a href="https://www.iotspace.tech">Back to IoT Space</a></li>
      				<li><a href="https://www.github.com/sahilsk11/coordinator" target="_blank">GitHub Page</a></li>
    			</ul>
    		</div>
 		</div>
	</nav>
	<div class="text-center">
		<img src="Helper/Images/co.png" class="page-logo">
		<hr width="65%" class="next-close">
		<br>
	</div>
	<div class="col-xs-6">
		<form id="userform" class="form-horizontal col-xs-11">
	 		<div class="form-group">
	    		<label class='control-label'>New Destination:</label>
	  			<input id="destination" class='form-control'>
	  			</input>
	  			<br>
	  			<button type='button' onClick='setDestination()' class='btn btn-default'>Submit</button>
	  		</div>
		</form>
	</div>
	<div>
		<p class="lead col-xs-6"><br>All destinations must be in the US</p>
	</div>

	<div id="new">
	</div>

	<div id="map" class="header">
		
	</div

</body>

